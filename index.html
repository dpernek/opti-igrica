<!doctype html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>JAN: 3D Mega Grad Autobot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Teko:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css?v=20260214-drive-2" />
  </head>
  <body>
    <main class="app-shell">
      <section class="hud">
        <h1>JAN: 3D Patrolna Vožnja</h1>
        <p class="subtitle">W/S gas-kočnica, A/D skretanje, Shift ručna, Space transformacija svih, E pomoć građanima</p>
        <div class="stats">
          <div><span>Reputacija:</span> <strong id="repValue">0</strong></div>
          <div><span>Završene misije:</span> <strong id="missionValue">0</strong></div>
          <div><span>Aktivni problem:</span> <strong id="activeIssue">Učitavanje grada...</strong></div>
        </div>
      </section>

      <section class="game-wrap">
        <canvas id="gameCanvas" aria-label="JAN 3D igra"></canvas>
        <div class="overlay" id="eventOverlay">Učitavanje 3D svijeta...</div>
        <div class="loader" id="loader">Učitavanje modela i grada...</div>
      </section>

      <section class="legend">
        <h2>Cilj</h2>
        <p>
          Vozi kroz grad u trećem licu, pronađi građane označene signalnim krugom i pritisni <strong>E</strong>
          da JAN i Autoboti riješe problem na licu mjesta.
        </p>
      </section>
    </main>

    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.getRegistrations().then((regs) => {
          regs.forEach((reg) => reg.unregister());
        });
      }

      window.__jan3dReady = false;
      setTimeout(() => {
        if (window.__jan3dReady) return;
        const loader = document.getElementById("loader");
        const overlay = document.getElementById("eventOverlay");
        if (loader) loader.classList.add("hidden");
        if (overlay) {
          overlay.textContent =
            "3D engine ili modeli nisu dostupni. Osvježi stranicu (Cmd+Shift+R) i provjeri vezu.";
        }
      }, 8000);
    </script>
    <script type="module" src="game.js?v=20260214-drive-2"></script>
  </body>
</html>
